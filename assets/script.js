var cities = ["Paris","Rome","San Francisco","Athens"];

function displayGif() {
    var cities = $(this).attr("data-name");
    var queryUrl = "https://api.giphy.com/v1/gifs/search?q=" + cities + "&api_key=iOHX93nrMn16dO24i1yv75hOVk5f6EAr&limit=10";

    // Ajax call
    $.ajax({ url: queryUrl, method: "GET"}).done(function(response) {
        
        $('.gifGoesHere').empty();

        for (let i = 0; i < response.data.length; i++) {
            // Variables to add HTML elements and standardize images generated by buttons
            var gifDiv     = $('<div class="gifDiv">');
            var rating     = response.data[i].rating;
            var ratingDiv  = $('<p>').html("Rating: " + rating);
            var animated   = response.data[i].images.fixed_height.url;
            var still      = response.data[i].images.fixed_height_still.url;
            var gifImg     = $('<img class="gImage">');
            
            // Defaulting gifs to still
            gifImg.attr('src', still);
            gifImg.attr('data-still', still);
            gifImg.attr('data-animate', animated);
            gifImg.attr('data-state', 'still')
            
            // Ratings
            gifDiv.append(ratingDiv);
            gifDiv.prepend(gifImg);
            $('.gifGoesHere').prepend(gifDiv);
        }
    });
};

// Onclick function to animate/pause gifs
$('.gifGoesHere').on("click", ".gImage", function() {

    var state = $(this).attr('data-state');
    // If state = still, on click will animate the gif
    if (state == 'still') {
        $(this).attr('src', $(this).data('animate'));
        $(this).attr('data-state', 'animate');}
    // Otherwise, if state != still, gif will pause on click   
    else {
        $(this).attr('src', $(this).data('still'));
        $(this).attr('data-state', 'still');
    }
});

// New buttons function
function renderButtons() {
  $(".buttons-original").empty();
  // Verifying buttons
  for (let i = 0; i < cities.length; i++) {
    let addButton = $('<button class="button">');
    addButton.addClass("cities");
    addButton.attr("data-name", cities[i]);
    addButton.html(cities[i]);

    // Appends new buttons to the end of the list of existing buttons
    $(".buttons-original").append(addButton);
  }
};

// New button created when field has a value entered and then cleared after confirming
$(".add-gif").on("click", function(event){
    event.preventDefault();
    var gifs = $(".gif-name").val().trim();
    cities.push(gifs);
    $(".gif-name").val("");
    renderButtons();
});


$(document).on("click", ".cities", displayGif);
renderButtons();
